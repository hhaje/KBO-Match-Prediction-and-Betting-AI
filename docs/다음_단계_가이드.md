# 다음 단계 가이드

## 🎯 현재 상태 요약

### ✅ 완료된 작업

1. **프로젝트 설계 및 문서화**
   - DB 설계 명세서
   - ML 모델 설계 명세서
   - API 인터페이스 정의
   - 프로젝트 구조 설계

2. **백엔드 (FastAPI)**
   - API 엔드포인트 구현
   - 서비스 레이어 구조
   - 모의 데이터 시스템
   - CORS 설정
   - **MySQL 스키마 설계** ⭐ NEW
   - **SQLAlchemy ORM 모델 작성** ⭐ NEW
   - **데이터베이스 초기화 스크립트** ⭐ NEW

3. **프론트엔드 (React)**
   - 대시보드 UI 완성
   - API 연동 완료
   - 실시간 데이터 로딩
   - 로딩/에러 처리
   - 차트 시각화

---

## 🚀 다음 단계 (우선순위)

### Phase 1: MySQL 데이터베이스 구축 (즉시 시작) 🔴

#### 작업 1-1: MySQL 설치 및 설정

**담당:** DB/백엔드 담당자  
**예상 시간:** 30분 ~ 1시간  
**가이드 문서:** [MySQL 설정 가이드](MySQL_설정_가이드.md)

**체크리스트:**
- [ ] MySQL 8.0+ 설치
- [ ] MySQL 서비스 시작
- [ ] 루트 비밀번호 설정
- [ ] MySQL 클라이언트 접속 확인

**명령어:**
```bash
# MySQL 설치 확인
mysql --version

# MySQL 접속
mysql -u root -p
```

---

#### 작업 1-2: 데이터베이스 생성 및 스키마 적용

**담당:** DB/백엔드 담당자  
**예상 시간:** 30분  
**파일:** `docs/database_schema_mysql.sql`

**체크리스트:**
- [ ] `kbo_betting_db` 데이터베이스 생성
- [ ] SQL 스키마 실행
- [ ] 초기 데이터 (팀, 베팅 모델) 입력 확인
- [ ] 테이블 구조 확인

**명령어:**
```bash
# 데이터베이스 생성
mysql -u root -p -e "CREATE DATABASE kbo_betting_db CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;"

# 스키마 적용
mysql -u root -p kbo_betting_db < docs/database_schema_mysql.sql

# 확인
mysql -u root -p -e "USE kbo_betting_db; SHOW TABLES; SELECT * FROM teams;"
```

---

#### 작업 1-3: 백엔드 환경 설정

**담당:** 백엔드 담당자  
**예상 시간:** 15분  
**파일:** `backend/.env`, `backend/env.template`

**체크리스트:**
- [ ] `.env` 파일 생성 (`env.template` 복사)
- [ ] 데이터베이스 접속 정보 입력
- [ ] MySQL 드라이버 패키지 설치
- [ ] 데이터베이스 연결 테스트

**명령어:**
```bash
cd backend

# .env 파일 생성 (Windows)
copy env.template .env

# .env 파일 생성 (Linux/Mac)
cp env.template .env

# .env 파일 편집
notepad .env  # Windows
vim .env      # Linux/Mac

# MySQL 드라이버 설치
pip install sqlalchemy pymysql cryptography

# 또는 전체 패키지 재설치
pip install -r requirements.txt
```

**`.env` 파일 예시:**
```env
DB_HOST=localhost
DB_PORT=3306
DB_NAME=kbo_betting_db
DB_USER=root
DB_PASSWORD=your_password_here
```

---

#### 작업 1-4: 데이터베이스 초기화

**담당:** 백엔드 담당자  
**예상 시간:** 10분  
**스크립트:** `backend/init_db.py`

**체크리스트:**
- [ ] 데이터베이스 연결 확인
- [ ] 테이블 생성 (ORM 모델 기반)
- [ ] 초기 데이터 입력
- [ ] 데이터 확인

**명령어:**
```bash
cd backend

# Python 초기화 스크립트 실행
python init_db.py
```

**예상 출력:**
```
🔍 데이터베이스 연결 확인 중...
✅ 데이터베이스 연결 성공
🏗️  테이블 생성 중...
✅ 데이터베이스 테이블이 생성되었습니다.
📊 초기 데이터 입력 중...
✅ 팀 정보 10개 입력 완료
✅ 베팅 모델 3개 입력 완료
```

---

### Phase 2: 백엔드 DB 통합 (1-2일) 🟡

#### 작업 2-1: 서비스 레이어 수정

**담당:** 백엔드 담당자  
**예상 시간:** 4-6시간  

**수정 대상 파일:**
- `backend/app/services/match_service.py`
- `backend/app/services/prediction_service.py`
- `backend/app/services/betting_service.py`
- `backend/app/services/performance_service.py`

**작업 내용:**
1. `mock_data` 함수 호출을 DB 쿼리로 변경
2. SQLAlchemy 세션 사용
3. 데이터 조회/생성/수정 로직 구현

**예시 (Before):**
```python
# 기존 (mock_data 사용)
from app.data.mock_data import generate_matches

def get_matches(start_date, end_date):
    return generate_matches(start_date, end_date)
```

**예시 (After):**
```python
# 변경 (DB 쿼리 사용)
from app.database import get_db
from app.models.db_models import Match, Team

def get_matches(start_date, end_date, db):
    matches = db.query(Match).filter(
        Match.match_date >= start_date,
        Match.match_date <= end_date
    ).all()
    return matches
```

---

#### 작업 2-2: API 엔드포인트 수정

**담당:** 백엔드 담당자  
**예상 시간:** 2-3시간  

**수정 대상 파일:**
- `backend/app/api/matches.py`
- `backend/app/api/predictions.py`
- `backend/app/api/betting.py`
- `backend/app/api/performance.py`

**작업 내용:**
1. `get_db()` 의존성 주입 추가
2. 서비스 함수에 DB 세션 전달
3. 응답 스키마 검증

**예시:**
```python
from fastapi import Depends
from sqlalchemy.orm import Session
from app.database import get_db

@router.get("/matches/")
def get_matches_endpoint(
    start_date: date = Query(...),
    end_date: date = Query(...),
    db: Session = Depends(get_db)
):
    matches = match_service.get_matches(start_date, end_date, db)
    return matches
```

---

### Phase 3: KBO 데이터 수집 (3-5일) 🟡

#### 작업 3-1: 웹 크롤러 개발

**담당:** 데이터 수집 담당자  
**예상 시간:** 2-3일  

**파일 생성:**
- `scripts/data_collection/kbo_scraper.py`
- `scripts/data_collection/odds_scraper.py`

**수집 대상:**
1. **KBO 공식 사이트** (https://www.koreabaseball.com/)
   - 경기 일정
   - 경기 결과
   - 팀 순위
   - 팀별 통계

2. **스포츠토토** (배당률)
   - 경기별 배당률
   - 실시간 업데이트

**기술 스택:**
- `requests` - HTTP 요청
- `BeautifulSoup4` - HTML 파싱
- `selenium` - 동적 페이지 (필요 시)

**예시 코드:**
```python
import requests
from bs4 import BeautifulSoup
from app.database import SessionLocal
from app.models.db_models import Match, Team

def scrape_kbo_games(season=2024):
    url = f"https://www.koreabaseball.com/Schedule/Schedule.aspx?seriesId={season}"
    response = requests.get(url)
    soup = BeautifulSoup(response.text, 'html.parser')
    
    # 파싱 로직...
    
    # DB 저장
    db = SessionLocal()
    for game_data in parsed_games:
        match = Match(**game_data)
        db.add(match)
    db.commit()
    db.close()
```

---

#### 작업 3-2: 데이터 정제 및 전처리

**담당:** 데이터 엔지니어  
**예상 시간:** 1-2일  

**파일 생성:**
- `scripts/preprocessing/clean_data.py`
- `scripts/preprocessing/feature_engineering.py`

**작업 내용:**
1. 결측값 처리
2. 이상치 제거
3. 데이터 정규화
4. ML 모델 입력 형식 변환

---

### Phase 4: ML 모델 개발 (1-2주) 🔵

#### 작업 4-1: 학습 데이터 준비

**담당:** ML 엔지니어  
**예상 시간:** 2-3일  

**파일 생성:**
- `ml/data_loader.py`
- `ml/preprocessing.py`

**작업 내용:**
1. DB에서 학습 데이터 추출
2. 시계열 시퀀스 생성
3. Train/Validation/Test 분할
4. 데이터 증강 (선택적)

---

#### 작업 4-2: LSTM 모델 구현

**담당:** ML 엔지니어  
**예상 시간:** 3-5일  

**파일 생성:**
- `ml/models/lstm_model.py`
- `ml/models/gru_model.py`
- `ml/models/ensemble_model.py`

**프레임워크:**
- PyTorch 또는 TensorFlow/Keras

**모델 아키텍처:**
```python
import torch.nn as nn

class KBOPredictionLSTM(nn.Module):
    def __init__(self, input_size, hidden_size, num_layers):
        super().__init__()
        self.lstm = nn.LSTM(input_size, hidden_size, num_layers, batch_first=True)
        self.fc = nn.Linear(hidden_size, 2)  # 홈팀 승률, 원정팀 승률
        
    def forward(self, x):
        lstm_out, _ = self.lstm(x)
        output = self.fc(lstm_out[:, -1, :])
        return torch.softmax(output, dim=1)
```

---

#### 작업 4-3: 모델 학습 및 평가

**담당:** ML 엔지니어  
**예상 시간:** 2-3일  

**파일 생성:**
- `ml/train.py`
- `ml/evaluate.py`
- `ml/hyperparameter_tuning.py`

**평가 지표:**
- Accuracy
- Log Loss
- Brier Score
- ROI (실제 베팅 시뮬레이션)

---

#### 작업 4-4: 백엔드 모델 통합

**담당:** 백엔드 + ML 담당자  
**예상 시간:** 1일  

**파일 생성/수정:**
- `backend/app/ml/model_loader.py`
- `backend/app/services/prediction_service.py` (수정)

**작업 내용:**
1. 학습된 모델 파일 로드
2. 예측 API에 연결
3. 전처리 파이프라인 통합
4. 응답 시간 최적화

---

### Phase 5: 통합 테스트 및 배포 (3-5일) 🟢

#### 작업 5-1: 전체 시스템 테스트

**체크리스트:**
- [ ] DB 연결 안정성 테스트
- [ ] API 응답 속도 측정
- [ ] 프론트엔드-백엔드 연동 확인
- [ ] ML 모델 예측 정확도 검증
- [ ] 동시 접속 부하 테스트

---

#### 작업 5-2: 배포 준비

**파일 생성:**
- `Dockerfile` (백엔드)
- `docker-compose.yml` (전체 시스템)
- `.github/workflows/deploy.yml` (CI/CD)

---

## 📋 우선순위별 작업 요약

### 즉시 시작 (오늘)
1. ✅ MySQL 설치
2. ✅ 데이터베이스 생성
3. ✅ 백엔드 환경 변수 설정
4. ✅ `init_db.py` 실행

### 이번 주 (1-3일)
5. ⏳ 서비스 레이어 DB 통합
6. ⏳ API 엔드포인트 수정
7. ⏳ 통합 테스트

### 다음 주 (4-7일)
8. ⏳ KBO 데이터 수집 시작
9. ⏳ 데이터 정제 파이프라인
10. ⏳ ML 모델 학습 데이터 준비

### 2주 후 (8-14일)
11. ⏳ LSTM 모델 개발
12. ⏳ 모델 학습 및 평가
13. ⏳ 백엔드 모델 통합

---

## 🎯 목표 달성 지표

### 단기 목표 (1주일)
- ✅ MySQL 데이터베이스 완전 통합
- ✅ 실제 데이터로 API 동작
- ✅ 프론트엔드에서 DB 데이터 표시

### 중기 목표 (2주일)
- ✅ 과거 KBO 데이터 1시즌 이상 수집
- ✅ 기본 예측 모델 (LSTM) 학습 완료
- ✅ 예측 정확도 60% 이상

### 장기 목표 (1개월)
- ✅ 실시간 데이터 수집 자동화
- ✅ 앙상블 모델 성능 70% 이상
- ✅ 베팅 시뮬레이션 ROI +15% 이상

---

## 💡 지금 당장 해야 할 일

### DB 담당자
```bash
# 1. MySQL 설치
# 2. 데이터베이스 생성
mysql -u root -p -e "CREATE DATABASE kbo_betting_db CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;"

# 3. 스키마 적용
mysql -u root -p kbo_betting_db < docs/database_schema_mysql.sql
```

### 백엔드 담당자
```bash
cd backend

# 1. .env 파일 생성
copy env.template .env  # Windows
cp env.template .env    # Linux/Mac

# 2. DB 정보 입력 (.env 편집)

# 3. 패키지 설치
pip install -r requirements.txt

# 4. DB 초기화
python init_db.py

# 5. 서버 실행 테스트
python run.py
```

### ML 담당자
- 데이터 수집 전략 수립
- 학습 데이터 요구사항 정리
- 모델 아키텍처 설계

---

**다음 단계를 시작할 준비가 되었습니다! 🚀**


