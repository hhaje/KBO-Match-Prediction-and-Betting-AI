# KBO ê²½ê¸° ì˜ˆì¸¡ AI ì‹œìŠ¤í…œ êµ¬í˜„ ê°€ì´ë“œ

## ğŸ“‹ ëª©ì°¨
1. [í™˜ê²½ ì„¤ì •](#1-í™˜ê²½-ì„¤ì •)
2. [ë°ì´í„°ë² ì´ìŠ¤ êµ¬ì¶•](#2-ë°ì´í„°ë² ì´ìŠ¤-êµ¬ì¶•)
3. [ë°ì´í„° ìˆ˜ì§‘](#3-ë°ì´í„°-ìˆ˜ì§‘)
4. [ML ëª¨ë¸ ê°œë°œ](#4-ml-ëª¨ë¸-ê°œë°œ)
5. [ë°±ì—”ë“œ API ê°œë°œ](#5-ë°±ì—”ë“œ-api-ê°œë°œ)
6. [í”„ë¡ íŠ¸ì—”ë“œ ì—°ë™](#6-í”„ë¡ íŠ¸ì—”ë“œ-ì—°ë™)
7. [í…ŒìŠ¤íŠ¸ ë° ë°°í¬](#7-í…ŒìŠ¤íŠ¸-ë°-ë°°í¬)

---

## 1. í™˜ê²½ ì„¤ì •

### 1.1 Python ê°€ìƒí™˜ê²½ ì„¤ì •

```bash
# ê°€ìƒí™˜ê²½ ìƒì„±
python -m venv venv

# ê°€ìƒí™˜ê²½ í™œì„±í™” (Windows)
venv\Scripts\activate

# ê°€ìƒí™˜ê²½ í™œì„±í™” (Linux/Mac)
source venv/bin/activate
```

### 1.2 Python íŒ¨í‚¤ì§€ ì„¤ì¹˜

**requirements.txt:**
```
# ë°ì´í„° ì²˜ë¦¬
pandas==2.1.0
numpy==1.24.3

# ë°ì´í„°ë² ì´ìŠ¤
sqlalchemy==2.0.20
psycopg2-binary==2.9.9

# ë¨¸ì‹ ëŸ¬ë‹
tensorflow==2.13.0
scikit-learn==1.3.0

# ë°±ì—”ë“œ
fastapi==0.103.0
uvicorn==0.23.2
python-dotenv==1.0.0

# ë°ì´í„° ìˆ˜ì§‘
requests==2.31.0
beautifulsoup4==4.12.2
selenium==4.11.2

# ì‹œê°í™”
matplotlib==3.7.2
seaborn==0.12.2

# í…ŒìŠ¤íŠ¸
pytest==7.4.0
pytest-cov==4.1.0
```

```bash
pip install -r requirements.txt
```

### 1.3 ë°ì´í„°ë² ì´ìŠ¤ ì„¤ì •

PostgreSQL ì„¤ì¹˜ ë° ë°ì´í„°ë² ì´ìŠ¤ ìƒì„±:

```bash
# PostgreSQL ì„¤ì¹˜ (Ubuntu)
sudo apt-get install postgresql postgresql-contrib

# PostgreSQL ì‹œì‘
sudo service postgresql start

# ë°ì´í„°ë² ì´ìŠ¤ ìƒì„±
sudo -u postgres createdb kbo_betting_db

# ì‚¬ìš©ì ìƒì„±
sudo -u postgres psql
CREATE USER kbo_user WITH PASSWORD 'your_password';
GRANT ALL PRIVILEGES ON DATABASE kbo_betting_db TO kbo_user;
\q
```

---

## 2. ë°ì´í„°ë² ì´ìŠ¤ êµ¬ì¶•

### 2.1 ìŠ¤í‚¤ë§ˆ ìƒì„±

```bash
# SQL ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰
psql -U kbo_user -d kbo_betting_db -f docs/database_schema.sql
```

ë˜ëŠ” Pythonìœ¼ë¡œ ì‹¤í–‰:

```python
# scripts/setup_database.py
from sqlalchemy import create_engine
import psycopg2

# ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²°
engine = create_engine('postgresql://kbo_user:your_password@localhost/kbo_betting_db')

# SQL íŒŒì¼ ì½ê¸° ë° ì‹¤í–‰
with open('docs/database_schema.sql', 'r', encoding='utf-8') as f:
    sql = f.read()
    
with engine.connect() as conn:
    conn.execute(sql)
    conn.commit()

print("ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ ìƒì„± ì™„ë£Œ!")
```

### 2.2 ì´ˆê¸° ë°ì´í„° ì…ë ¥

```python
# scripts/insert_initial_data.py
from sqlalchemy import create_engine
import pandas as pd

engine = create_engine('postgresql://kbo_user:your_password@localhost/kbo_betting_db')

# íŒ€ ì •ë³´ ì…ë ¥
teams_data = {
    'name': ['LG íŠ¸ìœˆìŠ¤', 'ë‘ì‚° ë² ì–´ìŠ¤', 'ì‚¼ì„± ë¼ì´ì˜¨ì¦ˆ', ...],
    'abbreviation': ['LG', 'ë‘ì‚°', 'ì‚¼ì„±', ...],
    'stadium_name': ['ì ì‹¤ì•¼êµ¬ì¥', 'ì ì‹¤ì•¼êµ¬ì¥', 'ëŒ€êµ¬ì‚¼ì„±ë¼ì´ì˜¨ì¦ˆíŒŒí¬', ...],
    'founded_year': [1982, 1982, 1982, ...]
}

df_teams = pd.DataFrame(teams_data)
df_teams.to_sql('teams', engine, if_exists='append', index=False)
```

---

## 3. ë°ì´í„° ìˆ˜ì§‘

### 3.1 ê²½ê¸° ë°ì´í„° ìˆ˜ì§‘

**scripts/data_collection/kbo_match_scraper.py:**

```python
import requests
from bs4 import BeautifulSoup
import pandas as pd
from sqlalchemy import create_engine
import time

def scrape_kbo_matches(season, start_date, end_date):
    """
    KBO ê²½ê¸° ê²°ê³¼ ìˆ˜ì§‘
    """
    matches = []
    
    # KBO ê³µì‹ ì‚¬ì´íŠ¸ í¬ë¡¤ë§ (ì˜ˆì‹œ)
    url = f"https://www.koreabaseball.com/Schedule/Schedule.aspx?leId=1&srId=0&season={season}"
    
    response = requests.get(url)
    soup = BeautifulSoup(response.content, 'html.parser')
    
    # ê²½ê¸° ë°ì´í„° íŒŒì‹±
    # ... (ì‹¤ì œ í¬ë¡¤ë§ ë¡œì§ êµ¬í˜„)
    
    return matches

def save_to_database(matches):
    """
    ìˆ˜ì§‘í•œ ê²½ê¸° ë°ì´í„°ë¥¼ DBì— ì €ì¥
    """
    engine = create_engine('postgresql://kbo_user:your_password@localhost/kbo_betting_db')
    
    df = pd.DataFrame(matches)
    df.to_sql('matches', engine, if_exists='append', index=False)

if __name__ == '__main__':
    # ìµœê·¼ 3ë…„ê°„ ë°ì´í„° ìˆ˜ì§‘
    for year in range(2021, 2024):
        matches = scrape_kbo_matches(year, f'{year}-01-01', f'{year}-12-31')
        save_to_database(matches)
        time.sleep(1)  # API í˜¸ì¶œ ì œí•œ
```

### 3.2 ë°°ë‹¹ë¥  ë°ì´í„° ìˆ˜ì§‘

**scripts/data_collection/odds_scraper.py:**

```python
def scrape_sportstoto_odds():
    """
    ìŠ¤í¬ì¸ í† í†  ë°°ë‹¹ë¥  ìˆ˜ì§‘
    """
    # ìŠ¤í¬ì¸ í† í†  ì‚¬ì´íŠ¸ í¬ë¡¤ë§
    # ... (ì‹¤ì œ êµ¬í˜„)
    pass
```

### 3.3 ìë™í™” ìŠ¤ì¼€ì¤„ë§

**scripts/scheduler.py:**

```python
import schedule
import time

def daily_data_collection():
    """
    ì¼ì¼ ë°ì´í„° ìˆ˜ì§‘ ì‘ì—…
    """
    # ìƒˆë¡œìš´ ê²½ê¸° ì¼ì • ìˆ˜ì§‘
    # ë°°ë‹¹ë¥  ì—…ë°ì´íŠ¸
    pass

# ë§¤ì¼ ì˜¤ì „ 9ì‹œ ì‹¤í–‰
schedule.every().day.at("09:00").do(daily_data_collection)

# ë§¤ ì‹œê°„ë§ˆë‹¤ ë°°ë‹¹ë¥  ì—…ë°ì´íŠ¸
schedule.every().hour.do(update_odds)

while True:
    schedule.run_pending()
    time.sleep(60)
```

---

## 4. ML ëª¨ë¸ ê°œë°œ

### 4.1 ë°ì´í„° ì „ì²˜ë¦¬

**scripts/preprocessing/feature_extraction.py:**

```python
import pandas as pd
import numpy as np

def extract_features():
    """
    ê²½ê¸° ë°ì´í„°ì—ì„œ íŠ¹ì„± ì¶”ì¶œ
    """
    # DBì—ì„œ ê²½ê¸° ë°ì´í„° ë¡œë“œ
    matches = pd.read_sql('SELECT * FROM matches WHERE is_completed = TRUE', engine)
    
    # íŒ€ë³„ íŠ¹ì„± ì¶”ì¶œ
    features = []
    for _, match in matches.iterrows():
        home_features = extract_team_features(matches, match['home_team_id'])
        away_features = extract_team_features(matches, match['away_team_id'])
        
        feature_vector = {
            'home_win_rate': home_features['win_rate'],
            'home_avg_score': home_features['avg_score'],
            'away_win_rate': away_features['win_rate'],
            'away_avg_score': away_features['avg_score'],
            'is_home': 1,
            'target': 1 if match['winner'] == 'home' else 0
        }
        features.append(feature_vector)
    
    return pd.DataFrame(features)
```

### 4.2 ëª¨ë¸ í•™ìŠµ

**scripts/training/train_lstm.py:**

```python
from tensorflow import keras
from sklearn.model_selection import train_test_split

def train_lstm_model():
    """
    LSTM ëª¨ë¸ í•™ìŠµ
    """
    # ë°ì´í„° ë¡œë“œ
    X, y = prepare_sequence_data(matches)
    
    # Train/Validation Split
    X_train, X_val, y_train, y_val = train_test_split(
        X, y, test_size=0.2, random_state=42
    )
    
    # ëª¨ë¸ ìƒì„±
    model = build_lstm_model()
    
    # í•™ìŠµ
    history = model.fit(
        X_train, y_train,
        validation_data=(X_val, y_val),
        epochs=50,
        batch_size=32,
        callbacks=[
            keras.callbacks.EarlyStopping(patience=5),
            keras.callbacks.ModelCheckpoint('models/lstm_best.h5', save_best_only=True)
        ]
    )
    
    # ëª¨ë¸ ì €ì¥
    model.save('models/lstm_model.h5')
    print("ëª¨ë¸ í•™ìŠµ ì™„ë£Œ!")

if __name__ == '__main__':
    train_lstm_model()
```

### 4.3 ëª¨ë¸ í‰ê°€

**scripts/evaluation/evaluate_model.py:**

```python
from sklearn.metrics import accuracy_score, log_loss, brier_score_loss

def evaluate_model(model, X_test, y_test):
    """
    ëª¨ë¸ ì„±ëŠ¥ í‰ê°€
    """
    predictions = model.predict(X_test)
    
    metrics = {
        'accuracy': accuracy_score(y_test, predictions > 0.5),
        'log_loss': log_loss(y_test, predictions),
        'brier_score': brier_score_loss(y_test, predictions),
    }
    
    # ê²°ê³¼ë¥¼ DBì— ì €ì¥
    save_performance_metrics('lstm_v1', metrics)
    
    return metrics
```

---

## 5. ë°±ì—”ë“œ API ê°œë°œ

### 5.1 FastAPI ì• í”Œë¦¬ì¼€ì´ì…˜ êµ¬ì¡°

**app/main.py:**

```python
from fastapi import FastAPI
from fastapi.middleware.cors import CORSMiddleware
from app.api import matches, predictions, betting, performance

app = FastAPI(title="KBO Betting AI API")

# CORS ì„¤ì •
app.add_middleware(
    CORSMiddleware,
    allow_origins=["http://localhost:3000"],
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)

# ë¼ìš°í„° ë“±ë¡
app.include_router(matches.router, prefix="/api/matches", tags=["matches"])
app.include_router(predictions.router, prefix="/api/predictions", tags=["predictions"])
app.include_router(betting.router, prefix="/api/betting", tags=["betting"])
app.include_router(performance.router, prefix="/api/performance", tags=["performance"])

@app.get("/")
async def root():
    return {"message": "KBO Betting AI API"}
```

### 5.2 API ì—”ë“œí¬ì¸íŠ¸ êµ¬í˜„

**app/api/predictions.py:**

```python
from fastapi import APIRouter, HTTPException
from app.services.prediction_service import PredictionService

router = APIRouter()
prediction_service = PredictionService()

@router.post("/{match_id}")
async def generate_prediction(match_id: int, model_name: str):
    """
    ê²½ê¸° ì˜ˆì¸¡ ìƒì„±
    """
    try:
        prediction = prediction_service.generate_prediction(match_id, model_name)
        return prediction
    except Exception as e:
        raise HTTPException(status_code=500, detail=str(e))

@router.get("/{match_id}")
async def get_prediction(match_id: int, model_name: str):
    """
    ì˜ˆì¸¡ ê²°ê³¼ ì¡°íšŒ
    """
    prediction = prediction_service.get_prediction(match_id, model_name)
    if not prediction:
        raise HTTPException(status_code=404, detail="ì˜ˆì¸¡ ê²°ê³¼ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤")
    return prediction
```

### 5.3 ì„œë¹„ìŠ¤ ë ˆì´ì–´ êµ¬í˜„

**app/services/prediction_service.py:**

```python
from app.models.database import get_db
from app.models.ml_models import load_model
import numpy as np

class PredictionService:
    def __init__(self):
        self.models = {}
    
    def generate_prediction(self, match_id: int, model_name: str):
        """
        ì˜ˆì¸¡ ìƒì„±
        """
        # ëª¨ë¸ ë¡œë“œ
        if model_name not in self.models:
            self.models[model_name] = load_model(model_name)
        
        model = self.models[model_name]
        
        # ê²½ê¸° ë°ì´í„° ë¡œë“œ
        match_data = get_match_data(match_id)
        
        # íŠ¹ì„± ì¶”ì¶œ
        features = extract_features(match_data)
        
        # ì˜ˆì¸¡
        prediction_prob = model.predict(features)
        
        # DBì— ì €ì¥
        save_prediction_to_db(match_id, model_name, prediction_prob)
        
        return {
            'match_id': match_id,
            'model_name': model_name,
            'home_win_probability': float(prediction_prob[0]),
            'away_win_probability': float(1 - prediction_prob[0])
        }
```

---

## 6. í”„ë¡ íŠ¸ì—”ë“œ ì—°ë™

### 6.1 API ì„œë¹„ìŠ¤ ìƒì„±

**frontend/src/services/api.js:**

```javascript
import axios from 'axios';

const API_BASE_URL = process.env.REACT_APP_API_URL || 'http://localhost:8000';

const api = axios.create({
  baseURL: API_BASE_URL,
  headers: {
    'Content-Type': 'application/json',
  },
});

export const matchesAPI = {
  getMatches: (startDate, endDate) =>
    api.get('/api/matches', { params: { start_date: startDate, end_date: endDate } }),
  
  getMatch: (matchId) =>
    api.get(`/api/matches/${matchId}`),
};

export const predictionsAPI = {
  generatePrediction: (matchId, modelName) =>
    api.post(`/api/predictions/${matchId}`, { model_name: modelName }),
  
  getPrediction: (matchId, modelName) =>
    api.get(`/api/predictions/${matchId}`, { params: { model_name: modelName } }),
};

export const bettingAPI = {
  getBettingResults: (model, period) =>
    api.get('/api/betting/results', { params: { model, period } }),
};

export const performanceAPI = {
  getPerformance: (modelName, period) =>
    api.get('/api/performance', { params: { model_name: modelName, period } }),
};
```

### 6.2 ì»´í¬ë„ŒíŠ¸ ì—°ë™

**frontend/src/components/Dashboard/ProfitAnalysis.js ìˆ˜ì •:**

```javascript
import { performanceAPI } from '../../services/api';
import { useState, useEffect } from 'react';

function ProfitAnalysis() {
  const [performanceData, setPerformanceData] = useState(null);

  useEffect(() => {
    loadPerformanceData();
  }, []);

  const loadPerformanceData = async () => {
    try {
      const response = await performanceAPI.getPerformance('lstm_v1', '30ì¼');
      setPerformanceData(response.data);
    } catch (error) {
      console.error('ì„±ëŠ¥ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error);
    }
  };

  // ... ë‚˜ë¨¸ì§€ ì½”ë“œ
}
```

---

## 7. í…ŒìŠ¤íŠ¸ ë° ë°°í¬

### 7.1 ë‹¨ìœ„ í…ŒìŠ¤íŠ¸

**tests/test_models.py:**

```python
import pytest
from app.models.ml_models import LSTM_Model

def test_lstm_prediction():
    model = LSTM_Model()
    test_data = np.random.randn(1, 10, 20)
    prediction = model.predict(test_data)
    
    assert prediction.shape == (1, 1)
    assert 0 <= prediction[0] <= 1
```

### 7.2 API í…ŒìŠ¤íŠ¸

```bash
# uvicornìœ¼ë¡œ ì„œë²„ ì‹¤í–‰
uvicorn app.main:app --reload

# API í…ŒìŠ¤íŠ¸
curl http://localhost:8000/api/predictions/1?model_name=lstm_v1
```

### 7.3 ë°°í¬

**Docker ì„¤ì •:**

```dockerfile
# Dockerfile
FROM python:3.9

WORKDIR /app

COPY requirements.txt .
RUN pip install -r requirements.txt

COPY . .

CMD ["uvicorn", "app.main:app", "--host", "0.0.0.0", "--port", "8000"]
```

**docker-compose.yml:**

```yaml
version: '3.8'

services:
  db:
    image: postgres:13
    environment:
      POSTGRES_DB: kbo_betting_db
      POSTGRES_USER: kbo_user
      POSTGRES_PASSWORD: your_password
    volumes:
      - postgres_data:/var/lib/postgresql/data

  backend:
    build: .
    ports:
      - "8000:8000"
    depends_on:
      - db
    environment:
      DATABASE_URL: postgresql://kbo_user:your_password@db/kbo_betting_db

volumes:
  postgres_data:
```

---

## 8. ëª¨ë‹ˆí„°ë§ ë° ìœ ì§€ë³´ìˆ˜

### 8.1 ëª¨ë¸ ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§

- ì£¼ê¸°ì ìœ¼ë¡œ ëª¨ë¸ ì„±ëŠ¥ ì§€í‘œ ì—…ë°ì´íŠ¸
- ì˜ˆì¸¡ ì •í™•ë„ ì¶”ì´ ëª¨ë‹ˆí„°ë§
- ë°ì´í„° ë“œë¦¬í”„íŠ¸ ê°ì§€

### 8.2 ìë™ ì¬í•™ìŠµ

- ì›”ë³„ ìë™ ì¬í•™ìŠµ ìŠ¤ì¼€ì¤„ ì„¤ì •
- ì„±ëŠ¥ ì €í•˜ ì‹œ ìë™ ì¬í•™ìŠµ íŠ¸ë¦¬ê±°

---

**ì´ ê°€ì´ë“œë¥¼ ë”°ë¼ ë‹¨ê³„ë³„ë¡œ êµ¬í˜„í•˜ì„¸ìš”!**


