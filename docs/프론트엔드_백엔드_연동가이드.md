# 프론트엔드-백엔드 연동 가이드

## ✅ 연동 완료!

프론트엔드와 백엔드가 성공적으로 연동되었습니다.

---

## 📦 연동된 컴포넌트

### 1. **ProfitAnalysis** (수익 분석)
- ✅ API 연동: `performanceAPI.getProfitAnalysis()`, `performanceAPI.getChartData()`
- ✅ 실시간 데이터 로드
- ✅ 날짜 범위 선택 시 데이터 업데이트
- ✅ 로딩/에러 처리

### 2. **BettingResults** (베팅 결과)
- ✅ API 연동: `bettingAPI.getBettingResults()`
- ✅ 실시간 베팅 내역 표시
- ✅ 최근 결과 강조
- ✅ 로딩/에러 처리

### 3. **PredictionPerformance** (예측 성능)
- ✅ API 연동: `performanceAPI.getModelPerformance()`
- ✅ 기간별 성능 지표 조회
- ✅ 정확도, Log Loss, Brier Score 표시
- ✅ 로딩/에러 처리

### 4. **BettingModelSelector** (베팅 모델 선택)
- ✅ API 연동: `bettingAPI.getBettingModelStats()`
- ✅ 모델별 통계 조회
- ✅ 승률, 수익률 표시
- ✅ 로딩/에러 처리

---

## 🚀 실행 방법

### 1. 백엔드 서버 시작

```bash
# Windows
start_backend.bat

# Linux/Mac
./start_backend.sh
```

백엔드가 `http://localhost:8000`에서 실행됩니다.

### 2. 프론트엔드 시작

```bash
cd frontend
npm install
npm start
```

프론트엔드가 `http://localhost:3000`에서 실행됩니다.

### 3. 브라우저에서 확인

http://localhost:3000 을 열면 다음을 확인할 수 있습니다:

- 📊 **수익 분석** - 날짜 범위별 ROI, 총 수익, 샤프 비율 등
- 📈 **베팅 결과** - 최근 베팅 내역 및 성과
- 🎯 **예측 성능** - 모델 정확도, Log Loss, Brier Score
- ⚙️ **베팅 모델** - 하이리턴/스탠다드/로우리스크 모델 통계

---

## 🔗 API 엔드포인트 매핑

### 프론트엔드 → 백엔드

| 프론트엔드 컴포넌트 | API 호출 | 백엔드 엔드포인트 |
|-------------------|---------|------------------|
| ProfitAnalysis | `performanceAPI.getProfitAnalysis()` | `GET /api/performance/profit` |
| ProfitAnalysis | `performanceAPI.getChartData()` | `GET /api/performance/chart` |
| BettingResults | `bettingAPI.getBettingResults()` | `GET /api/betting/results` |
| PredictionPerformance | `performanceAPI.getModelPerformance()` | `GET /api/performance/model` |
| BettingModelSelector | `bettingAPI.getBettingModelStats()` | `GET /api/betting/models/{model_name}/stats` |

---

## 🎨 주요 기능

### 1. 실시간 데이터 로딩

- 컴포넌트 마운트 시 자동으로 API 호출
- 사용자 인터랙션(기간 변경, 모델 선택 등) 시 데이터 업데이트

### 2. 로딩 상태 관리

- CircularProgress로 로딩 중 표시
- 데이터 로드 완료 후 자동으로 화면 렌더링

### 3. 에러 처리

- API 호출 실패 시 Alert로 에러 메시지 표시
- 사용자 친화적인 에러 안내

### 4. 최적화

- Promise.all을 사용한 병렬 API 호출
- 불필요한 리렌더링 방지
- 슬라이더 변경 완료 시에만 API 호출 (onChangeCommitted)

---

## 🔧 설정

### API Base URL

기본적으로 `http://localhost:8000`을 사용합니다.

변경하려면 `frontend/src/services/api.js`에서 수정:

```javascript
const API_BASE_URL = process.env.REACT_APP_API_URL || 'http://localhost:8000';
```

환경 변수 사용 (선택적):

프로젝트 루트에 `.env.local` 파일 생성:

```
REACT_APP_API_URL=http://localhost:8000
```

---

## 📝 데이터 흐름

```
사용자 인터랙션
    ↓
React 컴포넌트
    ↓
API 서비스 (frontend/src/services/api.js)
    ↓
Axios HTTP Request
    ↓
FastAPI 백엔드 (localhost:8000)
    ↓
서비스 레이어 (backend/app/services/)
    ↓
모의 데이터 생성 (backend/app/data/mock_data.py)
    ↓
HTTP Response
    ↓
React 상태 업데이트
    ↓
화면 렌더링
```

---

## 🐛 문제 해결

### 1. "Network Error" 또는 CORS 에러

**원인:** 백엔드 서버가 실행되지 않았거나 CORS 설정 문제

**해결:**
```bash
# 백엔드 서버 실행 확인
curl http://localhost:8000/health

# CORS 설정 확인 (backend/app/main.py)
allow_origins=["http://localhost:3000"]
```

### 2. 데이터가 로드되지 않음

**원인:** API 응답 형식 불일치

**해결:**
```bash
# 브라우저 개발자 도구 열기 (F12)
# Console 탭에서 에러 확인
# Network 탭에서 API 응답 확인
```

### 3. "Cannot read property of undefined"

**원인:** API 응답 데이터 구조가 예상과 다름

**해결:**
```javascript
// 안전한 접근 패턴 사용
const value = data?.field ?? defaultValue;
```

---

## ✅ 테스트 체크리스트

- [ ] 백엔드 서버 정상 실행 (`http://localhost:8000/health`)
- [ ] API 문서 확인 (`http://localhost:8000/docs`)
- [ ] 프론트엔드 서버 정상 실행 (`http://localhost:3000`)
- [ ] 수익 분석 컴포넌트 데이터 로드 확인
- [ ] 베팅 결과 목록 표시 확인
- [ ] 예측 성능 지표 표시 확인
- [ ] 베팅 모델 통계 표시 확인
- [ ] 날짜 범위 변경 시 데이터 업데이트 확인
- [ ] 베팅 모델 변경 시 통계 업데이트 확인
- [ ] 기간 선택 변경 시 성능 지표 업데이트 확인

---

## 📊 API 응답 예시

### 수익 분석
```json
{
  "period_start": "2024-01-01",
  "period_end": "2024-01-31",
  "roi": 15.2,
  "total_profit": 3200000,
  "sharpe_ratio": 1.92,
  "max_drawdown": -12.1,
  "win_rate": 71.2,
  "previous_roi": 11.8
}
```

### 베팅 결과
```json
{
  "results": [
    {
      "id": 1,
      "match_date": "2024-01-15",
      "home_team": "LG 트윈스",
      "away_team": "두산 베어스",
      "betting_model": "하이리턴",
      "betting_amount": 100000,
      "actual_profit": 150000,
      "actual_result": "win",
      "is_recent": true
    }
  ],
  "total": 1
}
```

---

## 🎯 다음 단계

현재는 모의 데이터를 사용하고 있습니다. 실제 시스템으로 전환하려면:

1. **데이터베이스 구축** - `docs/database_schema.sql` 실행
2. **실제 데이터 수집** - KBO 경기 데이터 수집 스크립트 작성
3. **ML 모델 통합** - 학습된 모델로 예측 생성
4. **백엔드 데이터 소스 교체** - `mock_data.py` → DB 쿼리

---

**프론트엔드와 백엔드가 완벽하게 연동되었습니다!** 🎉

이제 두 서버를 함께 실행하면 실시간으로 데이터가 업데이트되는 것을 확인할 수 있습니다.


